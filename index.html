<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- EMBEDDED FAVICON (Crosshair) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><style>@media(prefers-color-scheme:dark){line{stroke:white}}@media(prefers-color-scheme:light){line{stroke:black}}</style><line x1='32' y1='0' x2='32' y2='64' stroke='black' stroke-width='6'/><line x1='0' y1='32' x2='64' y2='32' stroke='black' stroke-width='6'/></svg>">
    <title>Mohammad Fasahat | Architecture</title>
    <style>
        /* --- CSS VARIABLES --- */
        :root {
            --bg-color: #050505;
            --text-primary: #FFFFFF;
            --text-secondary: #AAAAAA;
            --line-color: rgba(255, 255, 255, 0.8);
            --font-main: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        }

        body.light-mode {
            --bg-color: #F4F4F4;
            --text-primary: #111111;
            --text-secondary: #666666;
            --line-color: rgba(0, 0, 0, 0.8);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-family: var(--font-main);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: background-color 0.5s ease, color 0.5s ease;
            overscroll-behavior: none;
        }

        /* --- NAV --- */
        nav {
            display: flex; justify-content: space-between; align-items: center;
            padding: 40px 50px; position: fixed; top: 0; width: 100%; 
            z-index: 1000; /* Ensure clicks work */
            pointer-events: none; /* Let clicks pass through empty areas */
        }
        
        .brand, .nav-right { pointer-events: auto; }

        .brand { 
            font-size: 12px; font-weight: 700; letter-spacing: 1.5px; text-transform: uppercase; 
            color: var(--text-primary); cursor: pointer; text-decoration: none;
        }
        .nav-right { display: flex; align-items: center; gap: 30px; }
        
        .desktop-menu { display: flex; gap: 25px; }
        .desktop-menu a { 
            text-decoration: none; color: var(--text-secondary); font-size: 11px; 
            font-weight: 600; letter-spacing: 1px; text-transform: uppercase; 
            transition: color 0.3s;
        }
        .desktop-menu a:hover { color: var(--text-primary); }

        .mobile-menu-btn { 
            display: none; font-size: 11px; font-weight: 600; letter-spacing: 1px; 
            text-transform: uppercase; color: var(--text-primary); cursor: pointer; 
            padding: 10px; 
        }
        
        .theme-toggle {
            width: 18px; height: 18px; border-radius: 50%;
            background-color: var(--text-primary); border: 1px solid var(--bg-color);
            cursor: pointer; transition: transform 0.3s ease;
            position: relative; z-index: 1001;
        }
        .theme-toggle:hover { transform: scale(1.1); }

        /* --- IMAGES --- */
        .image-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            z-index: 0; pointer-events: none;
        }
        .bg-image {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; opacity: 0; transition: opacity 0.5s ease-in-out;
        }
        .bg-image.active { opacity: 0.5; }

        /* --- CANVAS --- */
        canvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10; cursor: crosshair; touch-action: none;
        }
        canvas.clickable { cursor: pointer; }

        .footer-info {
            position: absolute; bottom: 40px; left: 50px;
            font-size: 10px; color: var(--text-secondary);
            letter-spacing: 1px; text-transform: uppercase; 
            z-index: 100; pointer-events: none;
        }

        /* --- MOBILE OVERLAY --- */
        .mobile-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--bg-color); z-index: 500;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.4s ease;
        }
        .mobile-overlay.active { opacity: 1; pointer-events: all; }
        .mobile-links a {
            display: block; font-size: 24px; color: var(--text-primary);
            text-decoration: none; text-transform: uppercase; letter-spacing: 2px;
            margin-bottom: 30px; text-align: center;
        }

        @media (max-width: 768px) {
            nav { padding: 25px 20px; }
            .desktop-menu { display: none; }
            .mobile-menu-btn { display: block; }
            .footer-info { left: 20px; bottom: 30px; }
        }
    </style>
</head>
<body>

    <nav>
        <a href="index.html" class="brand">Mohammad Fasahat</a>
        <div class="nav-right">
            <div class="desktop-menu">
                <a href="works.html">Work</a>
                <a href="about.html">About</a>
            </div>
            <div class="theme-toggle" id="themeToggle"></div>
            <div class="mobile-menu-btn" id="mobileBtn">MENU</div>
        </div>
    </nav>

    <div class="mobile-overlay" id="mobileOverlay">
        <div class="mobile-links">
            <a href="index.html">Home</a>
            <a href="works.html">Work</a>
            <a href="about.html">About</a>
        </div>
    </div>

    <div class="image-container">
        <img src="images/hero-1.jpg" class="bg-image">
        <img src="images/hero-5.jpg" class="bg-image">
        <img src="images/eco/hero-2.jpg" class="bg-image">
        <img src="images/yazd/yazd-2.jpg" class="bg-image">
        <img src="images/housing/housing-1.jpg" class="bg-image">
    </div>

    <div class="footer-info">Interact to reveal</div>

    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const themeToggle = document.getElementById('themeToggle');
        const mobileBtn = document.getElementById('mobileBtn');
        const mobileOverlay = document.getElementById('mobileOverlay');
        const images = document.querySelectorAll('.bg-image');

        // --- THEME LOGIC ---
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'light') {
            document.body.classList.add('light-mode');
        }

        themeToggle.addEventListener('click', (e) => {
            e.stopPropagation(); // Essential: Stops click from reaching canvas
            document.body.classList.toggle('light-mode');
            
            if (document.body.classList.contains('light-mode')) {
                localStorage.setItem('theme', 'light');
            } else {
                localStorage.setItem('theme', 'dark');
            }
        });

        // --- MOBILE MENU ---
        let isMenuOpen = false;
        mobileBtn.addEventListener('click', (e) => {
            e.stopPropagation(); // Essential
            isMenuOpen = !isMenuOpen;
            if(isMenuOpen) {
                mobileOverlay.classList.add('active');
                mobileBtn.innerText = "CLOSE";
            } else {
                mobileOverlay.classList.remove('active');
                mobileBtn.innerText = "MENU";
            }
        });

        // --- CANVAS VARS ---
        let width, height;
        let points = [];
        let totalPoints = 80; 
        const mouseDist = 200; const damping = 0.06; const spring = 0.04; const pushForce = 4; 
        let lineY = 0;
        let mouse = { x: -1000, y: -1000 };
        
        // Interaction State
        let isHoveringCenter = false;
        let lastImageIndex = -1;
        let centerZoneRadius = 150; // Desktop hover radius
        let breathTimer = 0; 
        
        // Idle Wave
        let lastInteraction = Date.now();
        let wavePosition = -0.2;
        let waveSpeed = 0.008;

        // Touch State
        let touchStartY = 0;
        let touchStartX = 0;
        let isTap = false;

        class Point {
            constructor(x, y) {
                this.x = x; this.baseIy = y; this.iy = y; this.y = y; this.vy = 0;
            }
            update() {
                let forceY = (this.y - this.iy) * spring;
                let dx = mouse.x - this.x;
                let dy = mouse.y - this.y;
                let dist = Math.sqrt(dx * dx + dy * dy);
                
                if (dist < mouseDist) {
                    const force = (mouseDist - dist) / mouseDist;
                    const dir = dy < 0 ? -1 : 1; 
                    this.vy -= force * dir * pushForce; 
                }
                this.vy -= forceY;
                this.vy *= (1 - damping);
                this.y += this.vy;
            }
        }

        function init() {
            resize();
            points = [];
            totalPoints = window.innerWidth < 768 ? 50 : 100;
            const gap = width / (totalPoints - 1);
            lineY = height * 0.5; 
            for (let i = 0; i < totalPoints; i++) points.push(new Point(i * gap, lineY));
        }

        function resize() {
            const dpr = window.devicePixelRatio || 1;
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width * dpr;
            canvas.height = height * dpr;
            ctx.scale(dpr, dpr);
            canvas.style.width = width + 'px';
            canvas.style.height = height + 'px';
            lineY = height * 0.5;
            if(points.length > 0) points.forEach(p => { p.baseIy = lineY; p.iy = lineY; });
        }

        function animate() {
            const style = getComputedStyle(document.body);
            const lineColor = style.getPropertyValue('--line-color').trim();
            ctx.clearRect(0, 0, width, height);
            
            // Idle Wave (6 Seconds)
            const timeout = 6000;
            if (Date.now() - lastInteraction > timeout) {
                waveSpeed = window.innerWidth < 768 ? 0.02 : 0.008;
                wavePosition += waveSpeed;
                if (wavePosition > 1.5) wavePosition = -0.5;
                const waveWidth = window.innerWidth < 768 ? 0.3 : 0.15;

                for (let i = 0; i < points.length; i++) {
                    const p = points[i];
                    const normX = i / points.length;
                    const distFromWave = Math.abs(normX - wavePosition);
                    if (distFromWave < waveWidth) {
                        const strength = 1 - (distFromWave / waveWidth); 
                        const amp = window.innerWidth < 768 ? 40 : 60;
                        const offset = Math.sin(strength * Math.PI / 2) * amp;
                        p.iy = p.baseIy - offset; 
                    } else { p.iy = p.baseIy; }
                }
            } else {
                points.forEach(p => p.iy = p.baseIy);
            }

            // Draw
            ctx.beginPath();
            ctx.moveTo(points[0].x, points[0].y);
            for (let i = 0; i < points.length - 1; i++) {
                const p = points[i];
                const nextP = points[i + 1];
                p.update();
                const xc = (p.x + nextP.x) / 2;
                const yc = (p.y + nextP.y) / 2;
                ctx.quadraticCurveTo(p.x, p.y, xc, yc);
            }
            const last = points[points.length-1];
            last.update();
            ctx.lineTo(last.x, last.y);
            
            ctx.strokeStyle = lineColor;
            ctx.lineWidth = 1.5;
            ctx.stroke();

            requestAnimationFrame(animate);
        }

        // --- HELPER FUNCTIONS ---
        function showRandomImage() {
            images.forEach(img => img.classList.remove('active'));
            if(images.length === 0) return;
            let newIndex;
            do {
                newIndex = Math.floor(Math.random() * images.length);
            } while (newIndex === lastImageIndex && images.length > 1);
            lastImageIndex = newIndex;
            images[newIndex].classList.add('active');
        }

        function hideImages() {
            images.forEach(img => img.classList.remove('active'));
        }

        function triggerPhysicsRipple(x, y) {
             mouse.x = x;
             mouse.y = y;
             setTimeout(() => { mouse.x = -1000; mouse.y = -1000; }, 100);
        }

        // --- DESKTOP MOUSE LOGIC ---
        // Only active if screen width > 768
        window.addEventListener('mousemove', (e) => {
            if(window.innerWidth < 768) return; // Disable mouse logic on mobile
            
            lastInteraction = Date.now(); 
            mouse.x = e.clientX;
            mouse.y = e.clientY;
            
            // Hover check
            if (isMenuOpen) return;
            const centerX = window.innerWidth / 2;
            if (Math.abs(e.clientX - centerX) < centerZoneRadius) {
                if (!isHoveringCenter) {
                    isHoveringCenter = true;
                    showRandomImage();
                    canvas.classList.add('clickable');
                }
            } else {
                if (isHoveringCenter) {
                    isHoveringCenter = false;
                    hideImages();
                    canvas.classList.remove('clickable');
                }
            }
        });

        window.addEventListener('click', (e) => {
            // Skip if clicking nav or mobile
            if (e.target.closest('nav')) return;
            if (window.innerWidth < 768) return; // Mobile handled by touchend

            if(isHoveringCenter && !isMenuOpen) {
                window.location.href = "works.html"; 
            }
        });

        // --- MOBILE TOUCH LOGIC (THE FIX) ---
        window.addEventListener('touchstart', (e) => {
             if (e.target.closest('nav')) return;
             lastInteraction = Date.now();
             touchStartX = e.touches[0].clientX;
             touchStartY = e.touches[0].clientY;
             isTap = true; // Assume tap initially
        }, { passive: false });

        window.addEventListener('touchmove', (e) => {
             lastInteraction = Date.now();
             // If user moves finger more than 10px, it's a scroll/swipe, not a tap
             if (Math.abs(e.touches[0].clientY - touchStartY) > 10 || 
                 Math.abs(e.touches[0].clientX - touchStartX) > 10) {
                 isTap = false;
             }
             // Visual Physics ripple while dragging
             mouse.x = e.touches[0].clientX;
             mouse.y = e.touches[0].clientY;
        }, { passive: false });

        window.addEventListener('touchend', (e) => {
             lastInteraction = Date.now();
             // Reset physics mouse
             mouse.x = -1000; mouse.y = -1000;

             if (!isTap) return; // It was a scroll/swipe

             // TOUCH LOGIC:
             const touchY = e.changedTouches[0].clientY;
             const centerY = window.innerHeight / 2;
             // Zone: Middle 30% of screen
             const zoneHeight = window.innerHeight * 0.3; 
             const isCenter = Math.abs(touchY - centerY) < (zoneHeight / 2);

             if (isCenter) {
                 // Center Tap
                 if (!isHoveringCenter) {
                     // State 1: Show Image
                     isHoveringCenter = true;
                     showRandomImage();
                     triggerPhysicsRipple(e.changedTouches[0].clientX, touchY);
                 } else {
                     // State 2: Navigate
                     window.location.href = "works.html";
                 }
             } else {
                 // Outside Tap
                 if (isHoveringCenter) {
                     // Hide Image
                     isHoveringCenter = false;
                     hideImages();
                 }
                 // Always ripple physics
                 triggerPhysicsRipple(e.changedTouches[0].clientX, touchY);
             }
        });

        window.addEventListener('resize', () => { resize(); init(); });
        
        init();
        animate();
    </script>
</body>
</html>